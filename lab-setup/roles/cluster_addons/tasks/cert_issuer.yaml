---
- name: Apply ClusterIssuer (Letâ€™s Encrypt HTTP-01)
  kubernetes.core.k8s:
    state: present
    kubeconfig: "{{ kubeconfig_path }}"
    definition: |
      apiVersion: cert-manager.io/v1
      kind: ClusterIssuer
      metadata:
        name: {{ cert_issuer_name }}
      spec:
        acme:
          server: {{ acme_server_url }}
          email: {{ acme_email }}
          privateKeySecretRef:
            name: {{ acme_private_key_secret }}
          solvers:
            - http01:
                ingress:
                  class: {{ ingress_class }}
